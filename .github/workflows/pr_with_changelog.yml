name: Create PR with Changelog

on:
  push:
      branches:
            - 'automation/*'

            permissions:
              contents: write
                pull-requests: write

                jobs:
                  create-pr-with-changelog:
                      runs-on: ubuntu-latest

                              steps:
                                    - name: Checkout repository
                                            uses: actions/checkout@v4
                                                    with:
                                                              fetch-depth: 0

                                                                    - name: Generate Changelog
                                                                            id: changelog
                                                                                    run: |
                                                                                              cat > CHANGELOG.md << 'EOF'
                                                                                                        # История изменений / Changelog
                                                                                                        
                                                                                                                  ## [v1.0.0] - $(date +%Y-%m-%d)
                                                                                                                  
                                                                                                                            ### ✨ овые возожности
                                                                                                                                      - Автоматизация процеса создания Pull Request
                                                                                                                                                - Генерация CHANGELOG.md при оооовлениях
                                                                                                                                                          - GitHub Actions workflow для автоматической публикации
                                                                                                                                                                    - Шаблоны для релизов
                                                                                                                                                                    
                                                                                                                                                                              ###  Документация
                                                                                                                                                                                        - Добавлена инструкция по использованию автоматизации
                                                                                                                                                                                                  - Обновлён README с описанием новых функций
                                                                                                                                                                                                  
                                                                                                                                                                                                            ### 🔧 Технические улучшения
                                                                                                                                                                                                                      - Настроены GitHub Actions workflows
                                                                                                                                                                                                                                - Довлен PowerShell скрипт для развёртывания
                                                                                                                                                                                                                                          EOF
                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                              git config --local user.email "github-actions[bot]@users.noreply.github.com"
                                                                                                                                                                                                                                                                        git config --local user.name "github-actions[bot]"
                                                                                                                                                                                                                                                                                  git add CHANGELOG.md
                                                                                                                                                                                                                                                                                            git diff --cached --name-only > changed_files.txt
                                                                                                                                                                                                                                                                                                      echo "files<<EOF" >> $GITHUB_OUTPUT
                                                                                                                                                                                                                                                                                                                cat changed_files.txt >> $GITHUB_OUTPUT
                                                                                                                                                                                                                                                                                                                          echo "EOF" >> $GITHUB_OUTPUT
                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                - name: Create Pull Request
                                                                                                                                                                                                                                                                                                                                        uses: peter-evans/create-pull-request@v5
                                                                                                                                                                                                                                                                                                                                                with:
                                                                                                                                                                                                                                                                                                                                                          token: ${{ secrets.GITHUB_TOKEN }}
                                                                                                                                                                                                                                                                                                                                                                    commit-message: 'chore: обновление CHANGELOG.md'
                                                                                                                                                                                                                                                                                                                                                                              branch: ${{ github.ref_name }}
                                                                                                                                                                                                                                                                                                                                                                                        base: main
                                                                                                                                                                                                                                                                                                                                                                                                  title: 'Обновление проекта с CHANGELOG'
                                                                                                                                                                                                                                                                                                                                                                                                            body: |
                                                                                                                                                                                                                                                                                                                                                                                                                        ## 📋 Автоматическое обновление с журналом изменений
                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                Этот PR включает в себя:
                                                                                                                                                                                                                                                                                                                                                                                                                                                            - Обновлённый CHANGELOG.md
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        - Все последни измененя в проекте
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ### 📝 Изменённые файлы
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            ```
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ${{ steps.changelog.outputs.files }}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    ```
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            ### ℹ️ Действия
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        1. Проверьте изменени в CHANGELOG.md
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    2. Убедитесь, что все изменения корректно отображен
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                3. Утедите и объедините PR с оснвной веткой
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ---
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    🤖 Этот PR создан автоматически через GitHub Actions
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              draft: true
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        delete-branch: false
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  labels: |
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              automation
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          changelog
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      release
